<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Muzaffar OS Mobile</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    body {
      font-family: 'Segoe UI', 'Exo 2', sans-serif;
      background: #0a0a1a;
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      position: fixed;
      color: white;
    }
    #os-container {
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      position: relative;
    }
    .status-bar {
      height: 30px;
      background: rgba(0,0,0,0.3);
      backdrop-filter: blur(10px);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 15px;
      font-size: 14px;
      color: #00ffc8;
      border-bottom: 1px solid #00ffc8;
      z-index: 10;
    }
    .home-screens {
      flex: 1;
      position: relative;
      overflow: hidden;
    }
    .screens-wrapper {
      display: flex;
      width: 100%;
      height: 100%;
      transition: transform 0.3s ease;
    }
    .screen {
      flex: 0 0 100%;
      height: 100%;
      overflow-y: auto;
      padding: 15px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      align-content: flex-start;
    }
    .app-icon {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: white;
      font-size: 12px;
      cursor: pointer;
      padding: 10px 0;
      border-radius: 16px;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(5px);
      transition: 0.2s;
      border: 1px solid transparent;
    }
    .app-icon:active {
      background: rgba(0,255,200,0.2);
      transform: scale(0.95);
    }
    .app-icon i {
      font-size: 32px;
      margin-bottom: 5px;
      color: #00ffc8;
      filter: drop-shadow(0 0 5px cyan);
    }
    .dock {
      height: 80px;
      background: rgba(10,20,30,0.9);
      backdrop-filter: blur(15px);
      border-top: 2px solid #00ffc8;
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 0 10px;
      z-index: 10;
    }
    .dock-icon {
      flex: 1;
      max-width: 70px;
      display: flex;
      flex-direction: column;
      align-items: center;
      color: white;
      font-size: 11px;
      cursor: pointer;
      padding: 5px 0;
      border-radius: 20px;
    }
    .dock-icon i {
      font-size: 28px;
      color: #00ffc8;
    }
    .dock-icon.active {
      background: #00ffc8;
      color: #0a0a1a;
    }
    .dock-icon.active i {
      color: #0a0a1a;
    }
    .page-indicator {
      position: absolute;
      bottom: 90px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      gap: 8px;
      z-index: 5;
    }
    .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255,255,255,0.5);
      transition: 0.2s;
      cursor: pointer;
    }
    .dot.active {
      background: #00ffc8;
      width: 20px;
      border-radius: 10px;
    }
    .nav-arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      color: #00ffc8;
      font-size: 30px;
      cursor: pointer;
      z-index: 10;
      background: rgba(0,0,0,0.3);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(5px);
    }
    .nav-arrow.left {
      left: 5px;
    }
    .nav-arrow.right {
      right: 5px;
    }
    .app-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #1a1a2e;
      z-index: 20;
      display: none;
      flex-direction: column;
    }
    .app-screen-header {
      height: 50px;
      background: #0f1a24;
      display: flex;
      align-items: center;
      padding: 0 15px;
      border-bottom: 1px solid #00ffc8;
      color: #00ffc8;
    }
    .back-btn {
      background: none;
      border: none;
      color: #00ffc8;
      font-size: 24px;
      margin-right: 15px;
      cursor: pointer;
    }
    .app-screen-title {
      font-size: 18px;
      font-weight: bold;
    }
    .app-screen-content {
      flex: 1;
      background: white;
    }
    iframe {
      width: 100%;
      height: 100%;
      border: none;
      background: white;
    }
    /* Pay стили */
    .pay-container {
      padding: 20px;
      color: white;
    }
    .card {
      background: linear-gradient(145deg, #1c2a3a, #0f1a24);
      border: 1px solid #00ffc8;
      border-radius: 20px;
      padding: 20px;
      margin: 10px 0;
    }
    .card-number {
      font-size: 1.2em;
      letter-spacing: 2px;
      margin: 10px 0;
    }
    .card-balance {
      font-size: 2em;
      color: #00ffc8;
    }
    input, select, button {
      padding: 12px;
      border-radius: 30px;
      border: 1px solid #00ffc8;
      background: #0f1a24;
      color: white;
      margin: 5px 0;
      width: 100%;
    }
    button {
      background: #00ffc8;
      color: #0a0a1a;
      font-weight: bold;
    }
    .history-list {
      list-style: none;
      max-height: 200px;
      overflow-y: auto;
    }
    .history-list li {
      background: #0f1a24;
      padding: 10px;
      margin: 5px 0;
      border-left: 4px solid #00ffc8;
    }
    /* Настройки */
    .settings-container {
      padding: 20px;
      color: white;
    }
    .settings-container input {
      margin: 10px 0;
    }
  </style>
</head>
<body>
<div id="os-container">
  <!-- Статус бар -->
  <div class="status-bar">
    <span id="time">12:00</span>
    <span><i class="fas fa-signal"></i> <i class="fas fa-wifi"></i> <i class="fas fa-battery-full"></i></span>
  </div>

  <!-- Домашние экраны -->
  <div class="home-screens">
    <div class="screens-wrapper" id="screensWrapper"></div>
    <div class="page-indicator" id="pageIndicator"></div>
    <!-- Стрелки навигации (опционально) -->
    <div class="nav-arrow left" onclick="prevScreen()">‹</div>
    <div class="nav-arrow right" onclick="nextScreen()">›</div>
  </div>

  <!-- Док-панель -->
  <div class="dock" id="dock"></div>

  <!-- Экран открытого приложения -->
  <div class="app-screen" id="appScreen">
    <div class="app-screen-header">
      <button class="back-btn" onclick="closeApp()"><i class="fas fa-arrow-left"></i></button>
      <span class="app-screen-title" id="appScreenTitle">Приложение</span>
    </div>
    <div class="app-screen-content" id="appScreenContent">
      <iframe id="appIframe" sandbox="allow-same-origin allow-scripts allow-popups allow-forms"></iframe>
    </div>
  </div>
</div>

<script>
  // ---------- ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ ----------
  let userApps = JSON.parse(localStorage.getItem('muzaffar_mobile_apps') || '[]');
  let dockApps = []; // ID приложений в доке (закреплённые)
  let currentScreen = 0;
  const appsPerScreen = 12; // 4x3 на экране

  // Предустановленные приложения (все твои проекты)
  const builtInApps = [
    { name: "Paint", url: "https://saripovmuzaffar759-jpg.github.io/Muzaffar/paint", iconClass: "fas fa-paint-brush", category: "creative" },
    { name: "Фильмы и книги", url: "https://mrworld819.github.io/Muzaffar-films-and-books/", iconClass: "fas fa-film", category: "media" },
    { name: "Связь", url: "https://saripovmuzaffar759-jpg.github.io/Muzaffar/Zvonok", iconClass: "fas fa-phone", category: "media" },
    { name: "Тест личности", url: "https://saripovmuzaffar759-jpg.github.io/Muzaffar/typ", iconClass: "fas fa-user", category: "tools" },
    { name: "MUZAFFAR BANK", url: "https://saripovmuzaffar759-jpg.github.io/Muzaffar/Muzaffarbank", iconClass: "fas fa-university", category: "finance" },
    { name: "DREAM", url: "https://saripovmuzaffar759-jpg.github.io/Muzaffar/dream", iconClass: "fas fa-hand-holding-heart", category: "finance" },
    { name: "MUZAFFAR Сервисы", url: "https://Famd-sn.github.io/Muzaffar-/service", iconClass: "fas fa-concierge-bell", category: "tools" },
    { name: "MUZAFFAR время", url: "https://Famd-sn.github.io/Muzaffar-/time", iconClass: "fas fa-clock", category: "tools" },
    { name: "Muzaffarshop", url: "https://muzaffarsharipov058-creator.github.io/mag/", iconClass: "fas fa-shopping-cart", category: "finance" },
    { name: "MUZAFFAR навигатор", url: "https://Famd-sn.github.io/Muzaffar-/map.html", iconClass: "fas fa-map-marked-alt", category: "tools" },
    { name: "Викторина", url: "https://Famd-sn.github.io/Muzaffar-/7.html", iconClass: "fas fa-brain", category: "games" },
    { name: "MUZAFFAR помощник", url: "https://Famd-sn.github.io/Muzaffar-/ai.html", iconClass: "fas fa-robot", category: "ai" },
    { name: "MUZAFFAR HUB", url: "https://Fmad-sn.github.io/Muzaffar-/%D0%BF%D1%83%D0%B1%D0%BB.html", iconClass: "fas fa-cloud-upload-alt", category: "tools" },
    { name: "Ссылка", url: "https://Famd-sn.github.io/Muzaffar-/link.html", iconClass: "fas fa-link", category: "tools" },
    { name: "Планировщик", url: "https://Famd-sn.github.io/Muzaffar-/day.html", iconClass: "fas fa-calendar-alt", category: "tools" },
    { name: "Конверт файлов", url: "https://mrworld819.github.io/Muzaffar-/%D0%BF%D1%83%D0%B1%D0%BB.html", iconClass: "fas fa-exchange-alt", category: "tools" },
    { name: "Школьная бухгалтерия", url: "https://mrworld819.github.io/Muzaffar-/school.html", iconClass: "fas fa-calculator", category: "tools" },
    { name: "MUZAFFAR бронирование", url: "https://mrworld819.github.io/Muzaffar-/room.html", iconClass: "fas fa-hotel", category: "tools" },
    { name: "Такси", url: "https://mrworld819.github.io/Muzaffar-/taxi.html", iconClass: "fas fa-taxi", category: "tools" },
    { name: "Видео", url: "https://mrworld819.github.io/9/", iconClass: "fas fa-video", category: "media" },
    { name: "Словарь", url: "https://famd-sn.github.io/Muzaffar-/%D1%81%D0%BB%D0%BE%D0%B2%D0%B0%D1%80%D1%8C.html", iconClass: "fas fa-book", category: "tools" },
    { name: "Браузер", url: "https://famd-sn.github.io/Muzaffar-/%D0%B1%D1%80%D0%B0%D1%83%D0%B7%D0%B5%D1%80.html", iconClass: "fas fa-compass", category: "tools" },
    { name: "Конвертер валют", url: "https://mrworld819.github.io/-1/", iconClass: "fas fa-exchange-alt", category: "finance" },
    { name: "Музаффар Hub", url: "https://mrworld819.github.io/M/", iconClass: "fas fa-cloud-upload-alt", category: "tools" },
    { name: "Погода", url: "https://mrworld819.github.io/-MUZAFFARA/", iconClass: "fas fa-cloud-sun", category: "tools" },
    { name: "Muzaffar чат", url: "https://famd-sn.github.io/Muzaffar-/chat.html", iconClass: "fas fa-comments", category: "tools" },
    { name: "Карта", url: "https://mrworld819.github.io/vigilant-octo-waffle/", iconClass: "fas fa-map", category: "tools" },
    { name: "Портал игр", url: "https://mrworld819.github.io/book/index.html", iconClass: "fas fa-gamepad", category: "games" },
    { name: "HTML Editor", url: "https://mrworld819.github.io/html-editor/", iconClass: "fas fa-code", category: "tools" },
    { name: "MUZAFFAR OS", url: "https://famd-sn.github.io/Muzaffar-/os.html", iconClass: "fas fa-desktop", category: "tools" },
    { name: "Облако", url: "https://famd-sn.github.io/Muzaffar-/memory", iconClass: "fas fa-cloud", category: "tools" },
    { name: "Переводчик", url: "https://saripovmuzaffar759-jpg.github.io/Muzaffar/transleted.html", iconClass: "fas fa-language", category: "tools" },
    { name: "Новости", url: "https://famd-sn.github.io/Muzaffar-/nevs.html", iconClass: "fas fa-newspaper", category: "media" },
    { name: "Музыка", url: "https://famd-sn.github.io/Muzaffar-/nevs.html", iconClass: "fas fa-music", category: "media" },
    { name: "Финансы", url: "https://mrworld819.github.io/3/", iconClass: "fas fa-chart-line", category: "finance" },
    { name: "Обо мне", url: "https://mrworld819.github.io/-muzaffa/", iconClass: "fas fa-user-circle", category: "tools" },
    { name: "AI Ассистент", url: "https://share.character.ai/Wv9R/tbxe6z7n", iconClass: "fas fa-robot", category: "ai" },
    { name: "Трекер привычек", url: "https://famd-sn.github.io/Muzaffar-/%D0%BF%D1%80%D0%B8%D0%B2%D1%8B%D1%87%D0%BA%D0%B8.html", iconClass: "fas fa-tasks", category: "tools" },
    { name: "Планировщик задач", url: "https://famd-sn.github.io/Muzaffar-/%D0%BF%D0%BB%D0%B0%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D1%89%D0%B8%D0%BA.html", iconClass: "fas fa-calendar-check", category: "tools" },
    { name: "Калькулятор", url: "https://famd-sn.github.io/Muzaffar-/calculator.html", iconClass: "fas fa-calculator", category: "tools" },
    { name: "QR Генератор", url: "https://famd-sn.github.io/Muzaffar-/Qr.html", iconClass: "fas fa-qrcode", category: "tools" },
    { name: "Генератор идей", url: "https://famd-sn.github.io/Muzaffar-/ideya.html", iconClass: "fas fa-lightbulb", category: "tools" },
    { name: "Фоторедактор", url: "https://Famd-sn.github.io/Muzaffar-/foto.html", iconClass: "fas fa-image", category: "creative" },
    { name: "Погода подробно", url: "https://famd-sn.github.io/Muzaffar-/weather.html", iconClass: "fas fa-sun", category: "tools" },
    { name: "Заметки", url: "https://muzaffarsharipov058-creator.github.io/muzaffar/notes.html", iconClass: "fas fa-sticky-note", category: "tools" },
    { name: "Генератор паролей", url: "https://muzaffarsharipov058-creator.github.io/muzaffar/password.html", iconClass: "fas fa-key", category: "tools" },
    { name: "Таймер", url: "https://saripovmuzaffar759-jpg.github.io/Muzaffar/time", iconClass: "fas fa-hourglass-half", category: "tools" },
    { name: "Курсы валют", url: "https://famd-sn.github.io/Muzaffar-/currency.html", iconClass: "fas fa-money-bill-wave", category: "finance" },
    { name: "Криптовалюты", url: "https://muzaffarsharipov058-creator.github.io/muzaffar/birza.html", iconClass: "fas fa-coins", category: "finance" },
    { name: "Здоровье", url: "https://famd-sn.github.io/Muzaffar-/health.html", iconClass: "fas fa-heartbeat", category: "tools" },
    { name: "Энциклопедия", url: "https://saripovmuzaffar759-jpg.github.io/Muzaffar/encyclopedia", iconClass: "fas fa-book-open", category: "tools" },
    { name: "Путешествия", url: "https://famd-sn.github.io/Muzaffar-/travel.html", iconClass: "fas fa-plane", category: "tools" },
    { name: "Кулинария", url: "https://muzaffarsharipov058-creator.github.io/muzaffar/food", iconClass: "fas fa-utensils", category: "creative" },
    { name: "Фитнес", url: "https://famd-sn.github.io/Muzaffar-/fitness.html", iconClass: "fas fa-dumbbell", category: "tools" },
    { name: "Музыкальный плеер", url: "https://muzaffarsharipov058-creator.github.io/muzaffar/music.html#gsc.tab=0", iconClass: "fas fa-headphones", category: "media" },
    { name: "Видеоредактор", url: "https://muzaffarsharipov058-creator.github.io/muzaffar/videoedit.html", iconClass: "fas fa-video", category: "creative" },
    { name: "X (чат)", url: "https://muzaffarsharipov058-creator.github.io/muzaffar/chat", iconClass: "fas fa-users", category: "tools" },
    { name: "Галерея", url: "https://muzaffarsharipov058-creator.github.io/muzaffar/gallery.html", iconClass: "fas fa-images", category: "creative" },
    { name: "MUZAFFAR язык", url: "https://muzaffarsharipov058-creator.github.io/muzaffar/shrift2%20(1).html", iconClass: "fas fa-language", category: "creative" }
  ];

  // ---------- ИНИЦИАЛИЗАЦИЯ ----------
  document.addEventListener('DOMContentLoaded', () => {
    // Если приложений нет, загружаем все встроенные
    if (userApps.length === 0) {
      userApps = builtInApps.map((app, index) => ({
        id: 'app_' + Date.now() + index + Math.random(),
        ...app
      }));
      localStorage.setItem('muzaffar_mobile_apps', JSON.stringify(userApps));
    }
    // Закреплённые приложения в доке (Настройки, Pay, Банк)
    // Создаём системные приложения, если их нет
    if (!userApps.find(a => a.id === 'settings_fixed')) {
      userApps.push({ id: 'settings_fixed', name: 'Настройки', iconClass: 'fas fa-cog', url: '#' });
    }
    if (!userApps.find(a => a.id === 'pay_fixed')) {
      userApps.push({ id: 'pay_fixed', name: 'Muzaffar Pay', iconClass: 'fas fa-credit-card', url: '#' });
    }
    if (!userApps.find(a => a.id === 'bank_fixed')) {
      userApps.push({ id: 'bank_fixed', name: 'Банк', iconClass: 'fas fa-university', url: '#' });
    }
    dockApps = ['settings_fixed', 'pay_fixed', 'bank_fixed'];
    renderHomeScreens();
    renderDock();
    updateTime();
    setInterval(updateTime, 1000);
    setupSwipe();
  });

  // ---------- ОТОБРАЖЕНИЕ ДОМАШНИХ ЭКРАНОВ ----------
  function renderHomeScreens() {
    const wrapper = document.getElementById('screensWrapper');
    const indicator = document.getElementById('pageIndicator');
    wrapper.innerHTML = '';
    // Разбиваем приложения на страницы (исключаем системные из сетки? оставим все)
    const allApps = userApps.filter(app => !app.id.startsWith('settings_fixed') && !app.id.startsWith('pay_fixed') && !app.id.startsWith('bank_fixed'));
    const pages = [];
    for (let i = 0; i < allApps.length; i += appsPerScreen) {
      pages.push(allApps.slice(i, i + appsPerScreen));
    }
    if (pages.length === 0) pages.push([]); // пустая страница

    pages.forEach((apps, idx) => {
      const screen = document.createElement('div');
      screen.className = 'screen';
      apps.forEach(app => {
        const icon = document.createElement('div');
        icon.className = 'app-icon';
        icon.setAttribute('data-appid', app.id);
        icon.innerHTML = `<i class="${app.iconClass}"></i><div>${app.name}</div>`;
        icon.addEventListener('click', () => openApp(app));
        screen.appendChild(icon);
      });
      wrapper.appendChild(screen);
    });

    // Индикаторы
    indicator.innerHTML = pages.map((_, i) => `<span class="dot ${i === currentScreen ? 'active' : ''}" onclick="goToScreen(${i})"></span>`).join('');
  }

  function renderDock() {
    const dock = document.getElementById('dock');
    dock.innerHTML = '';
    dockApps.forEach(appId => {
      const app = userApps.find(a => a.id === appId);
      if (!app) return;
      const icon = document.createElement('div');
      icon.className = 'dock-icon';
      icon.innerHTML = `<i class="${app.iconClass}"></i><div>${app.name}</div>`;
      icon.addEventListener('click', () => openApp(app));
      dock.appendChild(icon);
    });
  }

  // ---------- НАВИГАЦИЯ ПО СТРАНИЦАМ ----------
  function setupSwipe() {
    const screensWrapper = document.getElementById('screensWrapper');
    let touchstartX = 0;
    let touchendX = 0;
    let isSwiping = false;

    screensWrapper.addEventListener('touchstart', (e) => {
      touchstartX = e.changedTouches[0].screenX;
      isSwiping = true;
    }, { passive: false });

    screensWrapper.addEventListener('touchmove', (e) => {
      if (!isSwiping) return;
      const currentX = e.changedTouches[0].screenX;
      const diff = touchstartX - currentX;
      if (Math.abs(diff) > 10) {
        e.preventDefault();
      }
    }, { passive: false });

    screensWrapper.addEventListener('touchend', (e) => {
      if (!isSwiping) return;
      touchendX = e.changedTouches[0].screenX;
      const diff = touchstartX - touchendX;
      const pages = document.querySelectorAll('.screen').length;
      if (Math.abs(diff) > 30) {
        if (diff > 0 && currentScreen < pages - 1) {
          currentScreen++;
        } else if (diff < 0 && currentScreen > 0) {
          currentScreen--;
        }
        updateScreenPosition();
      }
      isSwiping = false;
    }, { passive: true });
  }

  function updateScreenPosition() {
    const wrapper = document.getElementById('screensWrapper');
    wrapper.style.transform = `translateX(-${currentScreen * 100}%)`;
    document.querySelectorAll('.dot').forEach((dot, i) => {
      dot.classList.toggle('active', i === currentScreen);
    });
  }

  function goToScreen(index) {
    const pages = document.querySelectorAll('.screen').length;
    if (index >= 0 && index < pages) {
      currentScreen = index;
      updateScreenPosition();
    }
  }

  function prevScreen() {
    if (currentScreen > 0) {
      currentScreen--;
      updateScreenPosition();
    }
  }

  function nextScreen() {
    const pages = document.querySelectorAll('.screen').length;
    if (currentScreen < pages - 1) {
      currentScreen++;
      updateScreenPosition();
    }
  }

  // ---------- ОТКРЫТИЕ ПРИЛОЖЕНИЯ ----------
  function openApp(app) {
    if (app.url === '#') {
      // Специальные встроенные приложения
      if (app.name === 'Настройки') {
        showSettings();
      } else if (app.name === 'Muzaffar Pay' || app.name === 'Банк') {
        showPay();
      }
      return;
    }
    document.getElementById('appScreenTitle').innerText = app.name;
    document.getElementById('appIframe').src = app.url;
    document.getElementById('appScreen').style.display = 'flex';
  }

  function closeApp() {
    document.getElementById('appScreen').style.display = 'none';
    document.getElementById('appIframe').src = 'about:blank';
  }

  // ---------- ВСТРОЕННОЕ ПРИЛОЖЕНИЕ НАСТРОЕК ----------
  function showSettings() {
    const content = document.getElementById('appScreenContent');
    content.innerHTML = `
      <div class="settings-container">
        <h2>Настройки</h2>
        <h3>Добавить приложение</h3>
        <input type="text" id="newAppName" placeholder="Название">
        <input type="url" id="newAppUrl" placeholder="URL">
        <input type="text" id="newAppIcon" placeholder="Класс иконки (fas fa-globe)">
        <button onclick="createUserApp()">➕ Создать</button>
        <h3>Мои приложения</h3>
        <div id="appsListSettings"></div>
        <button onclick="restoreAllApps()">Восстановить все проекты</button>
        <button onclick="clearAllApps()" style="background:#ff6b6b;">Удалить все</button>
        <h3>Обои</h3>
        <select id="wallpaperSelect">
          <option value="dark">Тёмная</option>
          <option value="blue">Синяя</option>
          <option value="space">Космос</option>
        </select>
      </div>
    `;
    document.getElementById('appScreenTitle').innerText = 'Настройки';
    document.getElementById('appScreen').style.display = 'flex';
    updateAppsListSettings();
    document.getElementById('wallpaperSelect').addEventListener('change', changeWallpaper);
  }

  function createUserApp() {
    const name = document.getElementById('newAppName').value.trim();
    const url = document.getElementById('newAppUrl').value.trim();
    const iconClass = document.getElementById('newAppIcon').value.trim() || 'fas fa-globe';
    if (!name || !url) return alert('Заполните название и URL');
    const newApp = { id: 'app_' + Date.now(), name, url, iconClass };
    userApps.push(newApp);
    localStorage.setItem('muzaffar_mobile_apps', JSON.stringify(userApps));
    renderHomeScreens();
    updateAppsListSettings();
  }

  function updateAppsListSettings() {
    const list = document.getElementById('appsListSettings');
    if (!list) return;
    const nonSystemApps = userApps.filter(a => !a.id.startsWith('settings_fixed') && !a.id.startsWith('pay_fixed') && !a.id.startsWith('bank_fixed'));
    list.innerHTML = nonSystemApps.map(app => `
      <div style="display:flex; justify-content:space-between; background:#0f1a24; padding:5px; margin:5px;">
        <span><i class="${app.iconClass}"></i> ${app.name}</span>
        <button onclick="deleteApp('${app.id}')">Удалить</button>
      </div>
    `).join('');
  }

  function deleteApp(id) {
    if (id.startsWith('settings_fixed') || id.startsWith('pay_fixed') || id.startsWith('bank_fixed')) {
      alert('Нельзя удалить системное приложение');
      return;
    }
    userApps = userApps.filter(a => a.id !== id);
    localStorage.setItem('muzaffar_mobile_apps', JSON.stringify(userApps));
    renderHomeScreens();
    updateAppsListSettings();
  }

  function restoreAllApps() {
    const existingUrls = new Set(userApps.map(a => a.url));
    builtInApps.forEach(app => {
      if (!existingUrls.has(app.url)) {
        userApps.push({ id: 'app_' + Date.now() + Math.random(), ...app });
      }
    });
    localStorage.setItem('muzaffar_mobile_apps', JSON.stringify(userApps));
    renderHomeScreens();
    updateAppsListSettings();
  }

  function clearAllApps() {
    if (confirm('Удалить все приложения? Системные останутся.')) {
      userApps = userApps.filter(a => a.id.startsWith('settings_fixed') || a.id.startsWith('pay_fixed') || a.id.startsWith('bank_fixed'));
      localStorage.setItem('muzaffar_mobile_apps', JSON.stringify(userApps));
      renderHomeScreens();
      updateAppsListSettings();
    }
  }

  function changeWallpaper(e) {
    const val = e.target.value;
    let bg;
    if (val === 'dark') bg = '#0a0a1a';
    else if (val === 'blue') bg = 'linear-gradient(135deg,#1c92d2,#f2fcfe)';
    else if (val === 'space') bg = 'linear-gradient(135deg,#0f2027,#203a43,#2c5364)';
    document.body.style.background = bg;
  }

  // ---------- MUZAFFAR PAY ----------
  let cards = JSON.parse(localStorage.getItem('muzaffar_cards') || '[{"id":"card1","number":"1234 5678 9012 3456","balance":5000,"holder":"Muzaffar"},{"id":"card2","number":"9876 5432 1098 7654","balance":2500,"holder":"Savings"}]');
  let transactions = JSON.parse(localStorage.getItem('muzaffar_transactions') || '[]');

  function showPay() {
    const content = document.getElementById('appScreenContent');
    content.innerHTML = `
      <div class="pay-container">
        <h2>Muzaffar Pay</h2>
        <div id="cardsContainer"></div>
        <div class="transfer-form">
          <h3>Перевод по карте</h3>
          <select id="fromCard"></select>
          <input type="text" id="toCardNumber" placeholder="Номер карты получателя">
          <input type="number" id="transferAmount" placeholder="Сумма">
          <button onclick="transferMoney()">Перевести</button>
        </div>
        <h3>История</h3>
        <ul class="history-list" id="transactionHistory"></ul>
        <button onclick="addNewCard()">Добавить карту</button>
      </div>
    `;
    document.getElementById('appScreenTitle').innerText = 'Muzaffar Pay';
    document.getElementById('appScreen').style.display = 'flex';
    updatePayUI();
  }

  function updatePayUI() {
    const container = document.getElementById('cardsContainer');
    if (!container) return;
    container.innerHTML = cards.map(c => `
      <div class="card">
        <div>${c.holder}</div>
        <div class="card-number">${c.number}</div>
        <div class="card-balance">${c.balance} ₮</div>
      </div>
    `).join('');
    const fromSelect = document.getElementById('fromCard');
    if (fromSelect) {
      fromSelect.innerHTML = cards.map(c => `<option value="${c.id}">${c.number} (${c.balance} ₮)</option>`).join('');
    }
    const historyEl = document.getElementById('transactionHistory');
    if (historyEl) {
      historyEl.innerHTML = transactions.map(t => `<li>${t.date} — ${t.from} → ${t.to}: ${t.amount} ₮</li>`).join('');
    }
    localStorage.setItem('muzaffar_cards', JSON.stringify(cards));
    localStorage.setItem('muzaffar_transactions', JSON.stringify(transactions));
  }

  function transferMoney() {
    const fromCardId = document.getElementById('fromCard').value;
    const toCardNumber = document.getElementById('toCardNumber').value.trim();
    const amount = parseFloat(document.getElementById('transferAmount').value);
    if (!amount || amount <= 0) return alert('Введите сумму');
    const fromCard = cards.find(c => c.id === fromCardId);
    if (!fromCard) return;
    if (fromCard.balance < amount) return alert('Недостаточно средств');
    const toCard = cards.find(c => c.number === toCardNumber);
    if (!toCard) return alert('Карта получателя не найдена');
    fromCard.balance -= amount;
    toCard.balance += amount;
    transactions.unshift({
      date: new Date().toLocaleString('ru-RU'),
      from: fromCard.number,
      to: toCard.number,
      amount: amount
    });
    updatePayUI();
    alert('Перевод выполнен');
  }

  function addNewCard() {
    const newCard = {
      id: 'card' + Date.now(),
      number: Math.random().toString().slice(2,6) + ' ' + Math.random().toString().slice(2,6) + ' ' + Math.random().toString().slice(2,6) + ' ' + Math.random().toString().slice(2,6),
      balance: 1000,
      holder: 'Новая карта'
    };
    cards.push(newCard);
    updatePayUI();
  }

  // ---------- ВРЕМЯ ----------
  function updateTime() {
    const now = new Date();
    document.getElementById('time').innerText = now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
  }

  // Экспорт глобальных функций
  window.openApp = openApp;
  window.closeApp = closeApp;
  window.createUserApp = createUserApp;
  window.deleteApp = deleteApp;
  window.restoreAllApps = restoreAllApps;
  window.clearAllApps = clearAllApps;
  window.transferMoney = transferMoney;
  window.addNewCard = addNewCard;
  window.goToScreen = goToScreen;
  window.prevScreen = prevScreen;
  window.nextScreen = nextScreen;
</script>
</body>
</html>
