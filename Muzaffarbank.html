<!DOCTYPE html>
<html lang="ru">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MUZAFFAR BANK — Премиум цифровой банк Таджикистана</title>

<!-- Иконка -->
<link rel="icon" type="image/png" href="https://i.ibb.co/4ndNJYKS/Chat-GPT-Image-14-2025-21-36-48.png">

<!-- Шрифты -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<!-- QR Code библиотеки -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>

<style>
  /* ===== ОСНОВНЫЕ СТИЛИ ===== */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  :root {
    --primary: #0a4d2e;
    --primary-dark: #073a22;
    --primary-light: #1a5e3a;
    --secondary: #ff9f29;
    --accent: #0088cc;
    --success: #38b000;
    --danger: #d00000;
    --warning: #ff9f1c;
    --info: #0077b6;
    --light: #f8f9fa;
    --dark: #1a1e24;
    --white: #ffffff;
    --gold: #ffd700;
    --gold-dark: #b8860b;
    --platinum: #e5e4e2;
    --platinum-dark: #a0a0a0;
    
    --shadow-sm: 0 4px 6px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 10px 25px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.15);
    
    --radius-lg: 16px;
    --radius-xl: 24px;
    --radius-2xl: 32px;
    
    --space-sm: 12px;
    --space-md: 16px;
    --space-lg: 24px;
    --space-xl: 32px;
    --space-2xl: 48px;
  }
  
  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    color: var(--dark);
  }
  
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 var(--space-md);
  }
  
  .hidden {
    display: none !important;
  }
  
  /* ===== ХЕДЕР ===== */
  .header {
    background: var(--white);
    box-shadow: var(--shadow-sm);
    padding: var(--space-md) 0;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  
  .header-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .logo {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    font-weight: 700;
    font-size: 1.25rem;
    color: var(--primary);
  }
  
  .logo img {
    height: 40px;
    width: 40px;
    border-radius: 10px;
  }
  
  /* ===== КНОПКИ ===== */
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: var(--space-sm) var(--space-lg);
    border-radius: 50px;
    font-weight: 600;
    font-size: 0.95rem;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    gap: var(--space-sm);
  }
  
  .btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: var(--white);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
  }
  
  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
  }
  
  .btn-outline {
    background: transparent;
    border: 2px solid var(--white);
    color: var(--white);
  }
  
  .btn-outline:hover {
    background: var(--white);
    color: var(--primary);
  }
  
  .btn-gold {
    background: linear-gradient(135deg, #ffd700, #b8860b);
    color: var(--dark);
    font-weight: 700;
  }
  
  .btn-platinum {
    background: linear-gradient(135deg, #e5e4e2, #a0a0a0);
    color: var(--dark);
    font-weight: 700;
  }
  
  .btn-small {
    padding: 6px 12px;
    font-size: 0.85rem;
  }
  
  /* ===== КАРТОЧКИ ===== */
  .card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: var(--radius-2xl);
    padding: var(--space-xl);
    box-shadow: var(--shadow-lg);
    margin-bottom: var(--space-lg);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }
  
  /* ===== БАНКОВСКАЯ КАРТА ===== */
  .bank-card {
    position: relative;
    height: 240px;
    border-radius: var(--radius-2xl);
    padding: var(--space-xl);
    color: var(--white);
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    margin-bottom: var(--space-xl);
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    transition: all 0.3s ease;
  }
  
  .bank-card:hover {
    transform: translateY(-5px) rotate(1deg);
    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
  }
  
  .bank-card.gold {
    background: linear-gradient(135deg, #ffd700, #b8860b);
    color: var(--dark);
  }
  
  .bank-card.platinum {
    background: linear-gradient(135deg, #e5e4e2, #a0a0a0);
    color: var(--dark);
  }
  
  .bank-card::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 60%);
    transform: rotate(30deg);
  }
  
  .bank-card-logo {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-lg);
    position: relative;
    z-index: 2;
  }
  
  .bank-card-chip {
    width: 40px;
    height: 30px;
    background: linear-gradient(135deg, #ffd700, #b8860b);
    border-radius: 6px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
  }
  
  .bank-card-type {
    font-size: 1rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 2px;
  }
  
  .bank-card-number {
    font-size: 1.5rem;
    letter-spacing: 3px;
    text-align: center;
    font-family: 'Courier New', monospace;
    margin: var(--space-xl) 0;
    position: relative;
    z-index: 2;
    text-shadow: 0 2px 5px rgba(0,0,0,0.3);
  }
  
  .bank-card-details {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    position: relative;
    z-index: 2;
  }
  
  .bank-card-name {
    font-size: 1rem;
    text-transform: uppercase;
    letter-spacing: 2px;
  }
  
  .bank-card-expiry {
    font-size: 1rem;
    font-family: monospace;
  }
  
  /* ===== БАЛАНС ===== */
  .balance-container {
    text-align: center;
    margin: var(--space-2xl) 0;
    padding: var(--space-xl);
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: var(--radius-2xl);
    box-shadow: var(--shadow-lg);
    border: 1px solid rgba(255,255,255,0.2);
  }
  
  .balance {
    font-size: 3rem;
    font-weight: 800;
    color: var(--primary);
    margin: var(--space-sm) 0;
    text-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  
  /* ===== БЫСТРЫЕ ДЕЙСТВИЯ ===== */
  .actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: var(--space-lg);
    margin-top: var(--space-lg);
  }
  
  .action-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: var(--space-xl) var(--space-lg);
    border-radius: var(--radius-2xl);
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    box-shadow: var(--shadow-md);
    cursor: pointer;
    transition: all 0.3s ease;
    border: 1px solid rgba(255,255,255,0.2);
  }
  
  .action-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: var(--white);
  }
  
  .action-card:hover .material-icons {
    color: var(--white);
  }
  
  .action-icon {
    font-size: 2.5rem;
    color: var(--primary);
    margin-bottom: var(--space-md);
    transition: all 0.3s ease;
  }
  
  /* ===== ТАБЫ ===== */
  .tabs {
    display: flex;
    gap: var(--space-sm);
    margin-bottom: var(--space-xl);
    overflow-x: auto;
    padding-bottom: 4px;
    flex-wrap: wrap;
  }
  
  .tab {
    padding: 12px 24px;
    cursor: pointer;
    font-weight: 600;
    color: var(--white);
    border-radius: 50px;
    transition: all 0.3s ease;
    white-space: nowrap;
    background: rgba(255,255,255,0.2);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
  }
  
  .tab:hover {
    background: rgba(255,255,255,0.3);
    transform: translateY(-2px);
  }
  
  .tab.active {
    background: var(--white);
    color: var(--primary);
  }
  
  /* ===== КАРТЫ ДЛЯ ПОКУПКИ ===== */
  .purchase-cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--space-xl);
    margin-top: var(--space-xl);
  }
  
  .purchase-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: var(--radius-2xl);
    padding: var(--space-xl);
    text-align: center;
    box-shadow: var(--shadow-lg);
    transition: all 0.3s ease;
    border: 2px solid transparent;
    position: relative;
    overflow: hidden;
  }
  
  .purchase-card::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 60%);
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .purchase-card:hover::before {
    opacity: 1;
  }
  
  .purchase-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 30px 60px rgba(0,0,0,0.3);
  }
  
  .purchase-card.debit {
    border-color: #667eea;
  }
  
  .purchase-card.gold {
    border-color: #ffd700;
  }
  
  .purchase-card.platinum {
    border-color: #a0a0a0;
  }
  
  .card-icon {
    font-size: 4rem !important;
    margin-bottom: var(--space-lg);
  }
  
  .debit .card-icon { color: #667eea; }
  .gold .card-icon { color: #ffd700; }
  .platinum .card-icon { color: #a0a0a0; }
  
  .card-title {
    font-size: 2rem;
    font-weight: 800;
    margin-bottom: var(--space-sm);
  }
  
  .card-price {
    font-size: 2.5rem;
    font-weight: 800;
    margin-bottom: var(--space-lg);
  }
  
  .debit .card-price { color: #667eea; }
  .gold .card-price { color: #b8860b; }
  .platinum .card-price { color: #6c757d; }
  
  /* ===== ВНЕШНИЕ КАРТЫ ===== */
  .external-cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: var(--space-lg);
    margin-top: var(--space-lg);
  }
  
  .external-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: var(--radius-xl);
    padding: var(--space-lg);
    box-shadow: var(--shadow-md);
    transition: all 0.3s ease;
    border-left: 4px solid var(--primary);
  }
  
  .external-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
  }
  
  .external-card.sber { border-left-color: #2e7d32; }
  .external-card.tinkoff { border-left-color: #ffdd2d; }
  .external-card.alfa { border-left-color: #ef3124; }
  .external-card.vtb { border-left-color: #003791; }
  
  .delete-external-btn {
    background: rgba(208, 0, 0, 0.1);
    color: var(--danger);
    border: none;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .delete-external-btn:hover {
    background: var(--danger);
    color: var(--white);
    transform: rotate(90deg);
  }
  
  /* ===== ФОРМЫ ===== */
  .form-group {
    margin-bottom: var(--space-lg);
  }
  
  .form-label {
    display: block;
    margin-bottom: var(--space-sm);
    font-weight: 600;
    color: var(--dark);
  }
  
  .form-control {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid rgba(255,255,255,0.2);
    border-radius: 50px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: rgba(255,255,255,0.9);
  }
  
  .form-control:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
  }
  
  /* ===== МОДАЛЬНЫЕ ОКНА ===== */
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    backdrop-filter: blur(10px);
    padding: var(--space-md);
  }
  
  .modal-content {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: var(--radius-2xl);
    padding: var(--space-xl);
    max-width: 500px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: var(--shadow-lg);
    border: 1px solid rgba(255,255,255,0.2);
  }
  
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-lg);
  }
  
  .modal-title {
    font-size: 1.5rem;
    font-weight: 800;
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    color: var(--primary);
  }
  
  .modal-close {
    background: none;
    border: none;
    font-size: 2rem;
    cursor: pointer;
    color: #999;
    transition: all 0.3s ease;
  }
  
  .modal-close:hover {
    color: var(--danger);
    transform: rotate(90deg);
  }
  
  .modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: var(--space-sm);
    margin-top: var(--space-lg);
  }
  
  /* ===== КНОПКИ ДЕЙСТВИЙ ===== */
  .action-buttons {
    position: fixed;
    bottom: 30px;
    right: 30px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    z-index: 1000;
  }
  
  .action-btn {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    border: none;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    position: relative;
  }
  
  .action-btn:hover {
    transform: scale(1.2) translateY(-5px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.4);
  }
  
  .tooltip {
    position: absolute;
    right: 75px;
    background: var(--dark);
    color: white;
    padding: 8px 16px;
    border-radius: 40px;
    font-size: 14px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }
  
  .action-btn:hover .tooltip {
    opacity: 1;
    right: 85px;
  }
  
  .btn-taxi { background: linear-gradient(135deg, #ff9f29, #e68a00); }
  .btn-ai { background: linear-gradient(135deg, #8e44ad, #6c3483); }
  .btn-shop { background: linear-gradient(135deg, #ff6b6b, #ee5253); }
  .btn-exchange { background: linear-gradient(135deg, #4a90e2, #2c3e50); }
  .btn-stocks { background: linear-gradient(135deg, #27ae60, #16a085); }
  .btn-telegram { background: linear-gradient(135deg, #0088cc, #006699); }
  .btn-call { background: linear-gradient(135deg, #2ecc71, #27ae60); }
  
  /* ===== СПИСОК КАРТ ===== */
  .cards-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: var(--space-lg);
    margin-bottom: var(--space-lg);
  }
  
  .card-item {
    height: 180px;
    border-radius: var(--radius-xl);
    padding: var(--space-lg);
    color: var(--white);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  
  .card-item:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
  }
  
  .card-item.active {
    border: 3px solid var(--white);
    box-shadow: 0 0 0 3px var(--primary);
  }
  
  .card-status {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(255,255,255,0.2);
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
    backdrop-filter: blur(5px);
  }
  
  /* ===== УВЕДОМЛЕНИЯ ===== */
  .alert {
    padding: var(--space-md);
    border-radius: var(--radius-lg);
    margin-bottom: var(--space-md);
    animation: slideIn 0.3s ease;
  }
  
  @keyframes slideIn {
    from { transform: translateX(-20px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  
  .alert-success {
    background: rgba(56, 176, 0, 0.2);
    color: #2e7d32;
    border-left: 4px solid #2e7d32;
  }
  
  .alert-error {
    background: rgba(208, 0, 0, 0.2);
    color: #c62828;
    border-left: 4px solid #c62828;
  }
  
  /* ===== ФУТЕР ===== */
  .footer {
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    color: var(--white);
    padding: var(--space-2xl) 0;
    margin-top: var(--space-2xl);
  }
  
  /* ===== АДАПТИВНОСТЬ ===== */
  @media (max-width: 768px) {
    .action-buttons {
      bottom: 20px;
      right: 20px;
      gap: 10px;
    }
    
    .action-btn {
      width: 50px;
      height: 50px;
    }
    
    .tooltip {
      right: 65px;
      font-size: 12px;
      padding: 6px 12px;
    }
    
    .bank-card-number {
      font-size: 1.2rem;
    }
    
    .balance {
      font-size: 2rem;
    }
  }
</style>
</head>

<body>
  <!-- ===== КНОПКИ ДЕЙСТВИЙ ===== -->
  <div class="action-buttons">
    <button class="action-btn btn-taxi" onclick="window.open('https://famd-sn.github.io/Muzaffar-/taxi.html', '_blank')">
      <span class="material-icons">local_taxi</span>
      <span class="tooltip">Такси</span>
    </button>
    
  
    
    <button class="action-btn btn-shop" onclick="window.open('https://famd-sn.github.io/Muzaffar-/bankshop.html', '_blank')">
      <span class="material-icons">shopping_cart</span>
      <span class="tooltip">Магазин</span>
    </button>
    
    <button class="action-btn btn-exchange" onclick="window.open('https://famd-sn.github.io/Muzaffar-/coin.html', '_blank')">
      <span class="material-icons">currency_bitcoin</span>
      <span class="tooltip">Биржа</span>
    </button>
    
    <button class="action-btn btn-stocks" onclick="window.open('https://famd-sn.github.io/Muzaffar-/akci.html', '_blank')">
      <span class="material-icons">trending_up</span>
      <span class="tooltip">Акции</span>
    </button>
    
    <a href="https://t.me/fgvvn2" target="_blank" class="action-btn btn-telegram">
      <svg viewBox="0 0 24 24" width="28" height="28">
        <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.224-.536.224l.213-3.053 5.56-5.022c.241-.213-.054-.334-.373-.121l-6.869 4.326-2.962-.924c-.643-.203-.658-.643.136-.953l11.57-4.461c.538-.196 1.006.128.832.941z" fill="white"/>
      </svg>
      <span class="tooltip">Telegram</span>
    </a>
    
    <button class="action-btn btn-call" onclick="window.open('https://muzaffarsharipov058-creator.github.io/muzaffar/', '_blank')">
      <span class="material-icons">call</span>
      <span class="tooltip">Звонок</span>
    </button>
  </div>

  <!-- ===== ЭКРАН АВТОРИЗАЦИИ ===== -->
  <div id="auth-screen">
    <div class="container" style="min-height: 100vh; display: flex; align-items: center; justify-content: center;">
      <div class="card" style="max-width: 450px; width: 100%;">
        <div style="text-align: center; margin-bottom: var(--space-xl);">
          <div class="logo" style="justify-content: center;">
            <img src="https://i.ibb.co/4ndNJYKS/Chat-GPT-Image-14-2025-21-36-48.png" alt="MUZAFFAR BANK">
            <span>MUZAFFAR BANK</span>
          </div>
          <h2 style="color: var(--primary); margin: var(--space-lg) 0 var(--space-sm);">Добро пожаловать</h2>
          <p style="color: var(--gray-600);">Войдите или зарегистрируйтесь</p>
        </div>
        
        <!-- Форма входа -->
        <div id="login-form">
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" id="login-email" class="form-control" placeholder="Введите ваш email">
          </div>
          <div class="form-group">
            <label class="form-label">Пароль</label>
            <input type="password" id="login-password" class="form-control" placeholder="Введите пароль">
          </div>
          <button id="login-btn" class="btn btn-primary" style="width: 100%; margin-bottom: var(--space-md);">
            <span class="material-icons">login</span>Войти
          </button>
          <p style="text-align: center;">
            Нет аккаунта? 
            <a href="#" id="show-register" style="color: #667eea; font-weight: 600;">Зарегистрироваться</a>
          </p>
        </div>
        
        <!-- Форма регистрации -->
        <div id="register-form" style="display: none;">
          <div class="form-group">
            <label class="form-label">Полное имя</label>
            <input type="text" id="register-fullname" class="form-control" placeholder="Введите ваше полное имя">
          </div>
          <div class="form-group">
            <label class="form-label">Номер телефона</label>
            <input type="tel" id="register-phone" class="form-control" placeholder="+992 00 000 0000">
          </div>
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" id="register-email" class="form-control" placeholder="Введите ваш email">
          </div>
          <div class="form-group">
            <label class="form-label">Пароль</label>
            <input type="password" id="register-password" class="form-control" placeholder="Введите пароль (мин. 6 символов)">
          </div>
          <button id="register-btn" class="btn btn-primary" style="width: 100%; margin-bottom: var(--space-md);">
            <span class="material-icons">person_add</span>Зарегистрироваться
          </button>
          <p style="text-align: center;">
            Уже есть аккаунт? 
            <a href="#" id="show-login" style="color: #667eea; font-weight: 600;">Войти</a>
          </p>
        </div>
        
        <div id="auth-message" class="alert hidden"></div>
      </div>
    </div>
  </div>

  <!-- ===== ЭКРАН БАНКА ===== -->
  <div id="bank-screen" class="hidden">
    <!-- Хедер -->
    <header class="header">
      <div class="container header-container">
        <div class="logo">
          <img src="https://i.ibb.co/4ndNJYKS/Chat-GPT-Image-14-2025-21-36-48.png" alt="MUZAFFAR BANK">
          <span>MUZAFFAR BANK</span>
        </div>
        <div style="display: flex; align-items: center; gap: var(--space-md);">
          <span id="user-display-name" style="font-weight: 600; color: var(--primary);"></span>
          <span id="admin-badge" class="hidden" style="background: #ff9f29; color: var(--dark); padding: 4px 12px; border-radius: 50px; font-size: 12px; font-weight: 700;">АДМИН</span>
          <button id="logout-btn" class="btn btn-outline btn-small">
            <span class="material-icons">logout</span>Выйти
          </button>
        </div>
      </div>
    </header>

    <!-- Основной контент -->
    <main class="container" style="padding: var(--space-xl) 0;">
      <!-- Табы -->
      <div class="tabs">
        <div class="tab active" data-tab="dashboard">Главная</div>
        <div class="tab" data-tab="my-cards">Мои карты</div>
        <div class="tab" data-tab="external-cards">Другие банки</div>
        <div class="tab" data-tab="buy-cards">Купить карту</div>
        <div class="tab" data-tab="credits">Кредиты</div>
        <div class="tab" data-tab="qr-generator">QR-генератор</div>
      </div>
      
      <!-- ===== ГЛАВНАЯ ===== -->
      <div id="dashboard-tab" class="tab-content">
        <div class="bank-card" id="active-card-display">
          <div class="bank-card-logo">
            <div class="bank-card-chip"></div>
            <div class="bank-card-type" id="active-card-type-label">Дебетовая</div>
          </div>
          <div class="bank-card-number" id="active-card-number">•••• •••• •••• ••••</div>
          <div class="bank-card-details">
            <div class="bank-card-name" id="active-card-name">ИМЯ ВЛАДЕЛЬЦА</div>
            <div class="bank-card-expiry" id="active-card-expiry">12/28</div>
          </div>
        </div>

        <div class="balance-container">
          <div style="color: #666; margin-bottom: var(--space-sm);">
            <span class="material-icons">account_balance_wallet</span>
            Баланс
            <span id="active-card-badge" style="background: #667eea; color: white; padding: 4px 12px; border-radius: 50px; font-size: 12px; margin-left: 8px;">Основная</span>
          </div>
          <div class="balance" id="balance">0 сом.</div>
          <div style="display: flex; gap: var(--space-md); justify-content: center; margin-top: var(--space-lg); flex-wrap: wrap;">
            <button class="btn btn-primary" onclick="document.getElementById('deposit-modal').classList.remove('hidden')">
              <span class="material-icons">add</span>Пополнить
            </button>
            <button class="btn btn-primary" onclick="document.getElementById('transfer-modal').classList.remove('hidden')">
              <span class="material-icons">send</span>Перевести
            </button>
            <button class="btn btn-outline" onclick="showQuickQRCode()">
              <span class="material-icons">qr_code</span>QR-код
            </button>
          </div>
        </div>

        <div class="card">
          <h3 style="margin-bottom: var(--space-lg);">Быстрые действия</h3>
          <div class="actions-grid">
            <div class="action-card" onclick="document.getElementById('deposit-modal').classList.remove('hidden')">
              <span class="material-icons action-icon">account_balance</span>
              <span>Пополнить</span>
            </div>
            <div class="action-card" onclick="document.getElementById('transfer-modal').classList.remove('hidden')">
              <span class="material-icons action-icon">swap_horiz</span>
              <span>Перевести</span>
            </div>
            <div class="action-card" onclick="showQuickQRCode()">
              <span class="material-icons action-icon">qr_code_scanner</span>
              <span>Мой QR</span>
            </div>
            <div class="action-card" onclick="showTransactionHistory()">
              <span class="material-icons action-icon">history</span>
              <span>История</span>
            </div>
          </div>
        </div>

        <div class="card">
          <h3 style="margin-bottom: var(--space-lg);">Последние операции</h3>
          <div id="recent-transactions">
            <div style="text-align: center; padding: var(--space-2xl); color: #999;">
              <span class="material-icons" style="font-size: 48px; margin-bottom: var(--space-sm); display: block;">payments</span>
              <p>Нет операций</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- ===== МОИ КАРТЫ ===== -->
      <div id="my-cards-tab" class="tab-content hidden">
        <div class="card">
          <h3 style="margin-bottom: var(--space-lg);">Мои карты</h3>
          <div class="cards-container" id="cards-list"></div>
          <div style="text-align: center; margin-top: var(--space-xl);">
            <button id="add-card-btn" class="btn btn-primary">
              <span class="material-icons">add</span>Добавить карту
            </button>
          </div>
        </div>
      </div>
      
      <!-- ===== КАРТЫ ДРУГИХ БАНКОВ ===== -->
      <div id="external-cards-tab" class="tab-content hidden">
        <div class="card">
          <h3 style="margin-bottom: var(--space-lg);">Карты других банков</h3>
          <div id="external-cards-list" class="external-cards-grid"></div>
          <div style="text-align: center; margin-top: var(--space-xl);">
            <button id="add-external-card-btn" class="btn btn-primary">
              <span class="material-icons">add_link</span>Привязать карту
            </button>
          </div>
        </div>
      </div>
      
      <!-- ===== КУПИТЬ КАРТУ ===== -->
      <div id="buy-cards-tab" class="tab-content hidden">
        <div class="card">
          <h3 style="margin-bottom: var(--space-xl);">Выберите карту</h3>
          <div class="purchase-cards-grid">
            <!-- Дебетовая -->
            <div class="purchase-card debit">
              <span class="material-icons card-icon">credit_card</span>
              <div class="card-title">Дебетовая</div>
              <div class="card-price">0 сом.</div>
              <ul style="list-style: none; margin: var(--space-lg) 0; text-align: left;">
                <li style="margin: var(--space-sm) 0;">✓ Кэшбэк 1%</li>
                <li style="margin: var(--space-sm) 0;">✓ Бесплатные переводы</li>
                <li style="margin: var(--space-sm) 0;">✓ Снятие без комиссии</li>
              </ul>
              <button class="btn btn-primary get-card-btn" data-card-type="debit" style="width: 100%;">
                Получить
              </button>
            </div>
            
            <!-- Gold -->
            <div class="purchase-card gold">
              <span class="material-icons card-icon">star</span>
              <div class="card-title">Gold</div>
              <div class="card-price">500 сом.</div>
              <ul style="list-style: none; margin: var(--space-lg) 0; text-align: left;">
                <li style="margin: var(--space-sm) 0;">✓ Кэшбэк 3%</li>
                <li style="margin: var(--space-sm) 0;">✓ Приоритетная поддержка</li>
                <li style="margin: var(--space-sm) 0;">✓ Страхование $10,000</li>
              </ul>
              <button class="btn btn-gold get-card-btn" data-card-type="gold" style="width: 100%;">
                Купить
              </button>
            </div>
            
            <!-- Platinum -->
            <div class="purchase-card platinum">
              <span class="material-icons card-icon">diamond</span>
              <div class="card-title">Platinum</div>
              <div class="card-price">1000 сом.</div>
              <ul style="list-style: none; margin: var(--space-lg) 0; text-align: left;">
                <li style="margin: var(--space-sm) 0;">✓ Кэшбэк 5%</li>
                <li style="margin: var(--space-sm) 0;">✓ Персональный менеджер</li>
                <li style="margin: var(--space-sm) 0;">✓ Страхование $50,000</li>
                <li style="margin: var(--space-sm) 0;">✓ Доступ в VIP-залы</li>
              </ul>
              <button class="btn btn-platinum get-card-btn" data-card-type="platinum" style="width: 100%;">
                Купить
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- ===== КРЕДИТЫ ===== -->
      <div id="credits-tab" class="tab-content hidden">
        <div class="card">
          <h3 style="margin-bottom: var(--space-lg);">Кредитный калькулятор</h3>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-xl);">
            <div>
              <div class="form-group">
                <label class="form-label">Сумма кредита</label>
                <input type="number" id="credit-amount" class="form-control" value="10000">
              </div>
              <div class="form-group">
                <label class="form-label">Срок (месяцев)</label>
                <select id="credit-term" class="form-control">
                  <option value="6">6 месяцев</option>
                  <option value="12" selected>12 месяцев</option>
                  <option value="24">24 месяца</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Ставка</label>
                <select id="credit-rate" class="form-control">
                  <option value="12">12%</option>
                  <option value="10">10%</option>
                </select>
              </div>
              <div style="background: rgba(255,255,255,0.5); padding: var(--space-lg); border-radius: var(--radius-lg);">
                <div style="display: flex; justify-content: space-between;">
                  <span>Ежемесячный платеж:</span>
                  <span style="font-weight: 700; color: #667eea;" id="monthly-payment">0 сом.</span>
                </div>
              </div>
              <button id="apply-credit-btn" class="btn btn-primary" style="width: 100%; margin-top: var(--space-lg);">
                Оформить заявку
              </button>
            </div>
            <div style="background: rgba(255,255,255,0.5); padding: var(--space-lg); border-radius: var(--radius-lg);">
              <h4>Условия</h4>
              <p>✓ Гражданство Таджикистана</p>
              <p>✓ Возраст от 21 года</p>
              <p>✓ Постоянный доход</p>
            </div>
          </div>
        </div>
        
        <div class="card">
          <h4>Мои кредиты</h4>
          <div id="my-credits-list">
            <p style="text-align: center; color: #999; padding: var(--space-xl);">Нет кредитов</p>
          </div>
        </div>
      </div>
      
      <!-- ===== QR-ГЕНЕРАТОР ===== -->
      <div id="qr-generator-tab" class="tab-content hidden">
        <div class="card">
          <h3 style="margin-bottom: var(--space-lg);">QR-генератор</h3>
          <div class="form-group">
            <label class="form-label">Выберите карту:</label>
            <select id="qr-card-select" class="form-control"></select>
          </div>
          <div class="form-group">
            <label class="form-label">Сумма:</label>
            <input type="number" id="qr-amount" class="form-control" placeholder="Необязательно">
          </div>
          <button id="generate-qr-btn" class="btn btn-primary">
            <span class="material-icons">qr_code_2</span>Сгенерировать
          </button>
          <div id="qr-code-result" style="display: none; margin-top: var(--space-xl); text-align: center;">
            <div id="qrcode-display"></div>
            <div id="qr-display-card-number" style="margin-top: var(--space-md);"></div>
          </div>
        </div>
      </div>
    </main>

    <!-- Футер -->
    <footer class="footer">
      <div class="container">
        <div style="text-align: center;">
          <p>© 2026 MUZAFFAR BANK. Все права защищены.</p>
        </div>
      </div>
    </footer>
  </div>

  <!-- ===== МОДАЛЬНЫЕ ОКНА ===== -->
  
  <!-- Пополнение -->
  <div id="deposit-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">
          <span class="material-icons">add</span>
          Пополнение
        </h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Сумма</label>
          <input type="number" id="deposit-amount" class="form-control" placeholder="Введите сумму">
        </div>
        <div class="form-group">
          <label class="form-label">PIN-код</label>
          <input type="password" id="deposit-pin" class="form-control" placeholder="****" maxlength="4">
        </div>
        <div id="deposit-message" class="alert hidden"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline close-modal">Отмена</button>
        <button id="confirm-deposit" class="btn btn-primary">Пополнить</button>
      </div>
    </div>
  </div>

  <!-- Перевод -->
  <div id="transfer-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">
          <span class="material-icons">send</span>
          Перевод
        </h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Карта получателя</label>
          <input type="text" id="recipient-card" class="form-control" placeholder="0000 0000 0000 0000">
        </div>
        <div class="form-group">
          <label class="form-label">Сумма</label>
          <input type="number" id="transfer-amount" class="form-control" placeholder="Введите сумму">
        </div>
        <div class="form-group">
          <label class="form-label">PIN-код</label>
          <input type="password" id="transfer-pin" class="form-control" placeholder="****" maxlength="4">
        </div>
        <div style="background: rgba(102,126,234,0.1); padding: var(--space-md); border-radius: var(--radius-lg); margin-bottom: var(--space-md);">
          <span class="material-icons" style="vertical-align: middle; color: #667eea;">info</span>
          <span style="color: #667eea;">Комиссия: 1%</span>
        </div>
        <div id="transfer-message" class="alert hidden"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline close-modal">Отмена</button>
        <button id="confirm-transfer" class="btn btn-primary">Перевести</button>
      </div>
    </div>
  </div>

  <!-- Добавление карты MUZAFFAR BANK -->
  <div id="add-card-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">
          <span class="material-icons">add_card</span>
          Новая карта
        </h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Тип карты</label>
          <select id="new-card-type" class="form-control">
            <option value="debit">Дебетовая (0 сом.)</option>
            <option value="gold">Gold (500 сом.)</option>
            <option value="platinum">Platinum (1000 сом.)</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Название карты</label>
          <input type="text" id="new-card-name" class="form-control" placeholder="Моя карта">
        </div>
        <div class="form-group">
          <label class="form-label">PIN-код</label>
          <input type="password" id="new-card-pin" class="form-control" placeholder="****" maxlength="4" value="1234">
          <small style="color: #666;">Придумайте 4-значный PIN</small>
        </div>
        <div id="add-card-message" class="alert hidden"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline close-modal">Отмена</button>
        <button id="confirm-add-card" class="btn btn-primary">Добавить</button>
      </div>
    </div>
  </div>

  <!-- Добавление внешней карты -->
  <div id="add-external-card-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">
          <span class="material-icons">add_link</span>
          Привязать карту
        </h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Банк</label>
          <select id="external-bank" class="form-control">
            <option value="">-- Выберите банк --</option>
            <option value="Сбербанк">Сбербанк</option>
            <option value="Тинькофф">Тинькофф</option>
            <option value="Альфа-Банк">Альфа-Банк</option>
            <option value="ВТБ">ВТБ</option>
            <option value="Другой">Другой банк</option>
          </select>
        </div>
        <div id="custom-bank-group" class="form-group hidden">
          <label class="form-label">Название банка</label>
          <input type="text" id="custom-bank-name" class="form-control" placeholder="Введите название банка">
        </div>
        <div class="form-group">
          <label class="form-label">Номер карты</label>
          <input type="text" id="external-card-number" class="form-control" placeholder="0000 0000 0000 0000" maxlength="19">
        </div>
        <div class="form-group">
          <label class="form-label">Срок действия</label>
          <input type="text" id="external-card-expiry" class="form-control" placeholder="ММ/ГГ" maxlength="5">
        </div>
        <div class="form-group">
          <label class="form-label">Название карты</label>
          <input type="text" id="external-card-name" class="form-control" placeholder="Моя зарплатная карта">
        </div>
        <div class="form-group">
          <label class="form-label">Владелец</label>
          <input type="text" id="external-card-holder" class="form-control" placeholder="Имя на карте">
        </div>
        <div id="external-card-message" class="alert hidden"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline close-modal">Отмена</button>
        <button id="confirm-add-external-card" class="btn btn-primary">Привязать</button>
      </div>
    </div>
  </div>

  <!-- Кредит -->
  <div id="credit-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">
          <span class="material-icons">account_balance</span>
          Заявка на кредит
        </h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Сумма</label>
          <input type="number" id="credit-modal-amount" class="form-control" value="10000">
        </div>
        <div class="form-group">
          <label class="form-label">Срок (мес.)</label>
          <select id="credit-modal-term" class="form-control">
            <option value="6">6 месяцев</option>
            <option value="12">12 месяцев</option>
            <option value="24">24 месяца</option>
          </select>
        </div>
        <div id="credit-modal-message" class="alert hidden"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline close-modal">Отмена</button>
        <button id="confirm-credit-btn" class="btn btn-primary">Отправить</button>
      </div>
    </div>
  </div>

  <!-- QR-код -->
  <div id="qr-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">
          <span class="material-icons">qr_code</span>
          Мой QR-код
        </h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body" style="text-align: center;">
        <div id="qrcode-modal"></div>
        <div id="qr-modal-card-number" style="margin-top: var(--space-lg);"></div>
      </div>
    </div>
  </div>

  <script>
    // ==============================================
    // MUZAFFAR BANK - ПРОСТАЯ И КРАСИВАЯ ВЕРСИЯ
    // Telegram: 8031233615:AAGgZKmnpg27rBG351r4MslVg3Psi8Uykts
    // Chat ID: 5450527103
    // ==============================================
    
    // Telegram настройки
    const TELEGRAM_BOT_TOKEN = '8031233615:AAGgZKmnpg27rBG351r4MslVg3Psi8Uykts';
    const TELEGRAM_CHAT_ID = '5450527103';
    
    // Данные админа
    const ADMIN_EMAIL = "admin@muzaffar.tj";
    const ADMIN_PASSWORD = "Admin123!";
    const ADMIN_CARD_NUMBER = "4111 1111 1111 1111";

    // Типы карт
    const CARD_TYPES = {
      debit: { name: "Дебетовая", price: 0 },
      gold: { name: "Gold", price: 500 },
      platinum: { name: "Platinum", price: 1000 }
    };

    // Глобальные переменные
    let currentUser = null;
    let userCards = [];
    let externalCards = [];
    let userTransactions = [];
    let userCredits = [];
    let activeCardIndex = 0;

    // ==============================================
    // TELEGRAM УВЕДОМЛЕНИЯ
    // ==============================================
    
    async function sendTelegramMessage(message) {
      try {
        const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
        await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            chat_id: TELEGRAM_CHAT_ID,
            text: message,
            parse_mode: 'HTML'
          })
        });
      } catch (error) {
        console.log("Telegram сообщение:", message);
      }
    }

    // ==============================================
    // ИНИЦИАЛИЗАЦИЯ
    // ==============================================
    
    function initApp() {
      // Создаем админа
      if (!localStorage.getItem('adminCreated')) {
        createAdminAccount();
        localStorage.setItem('adminCreated', 'true');
      }
      
      // Проверяем сессию
      const savedUser = localStorage.getItem('currentUser');
      if (savedUser) {
        currentUser = JSON.parse(savedUser);
        loadUserData();
        showBankScreen();
      } else {
        showAuthScreen();
      }
      
      setupEventListeners();
      initCreditCalculator();
    }

    // Создание админа
    function createAdminAccount() {
      const adminCards = [{
        id: 'admin-card-1',
        type: 'platinum',
        number: ADMIN_CARD_NUMBER,
        name: 'Platinum Админа',
        balance: 999999999,
        isPrimary: true,
        pin: '0000',
        expiry: '12/99'
      }];

      const adminData = {
        email: ADMIN_EMAIL,
        password: ADMIN_PASSWORD,
        isAdmin: true,
        fullName: "Шарипов Музаффар Анварович",
        phone: "+992 92 631 0060",
        cards: adminCards,
        externalCards: [],
        transactions: [],
        credits: []
      };

      localStorage.setItem(ADMIN_EMAIL, JSON.stringify(adminData));
    }

    // ==============================================
    // АВТОРИЗАЦИЯ
    // ==============================================
    
    function handleLogin() {
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value;
      const message = document.getElementById('auth-message');
      
      if (!email || !password) {
        showMessage(message, "Введите email и пароль", false);
        return;
      }
      
      // Админ
      if (email === ADMIN_EMAIL && password === ADMIN_PASSWORD) {
        currentUser = { email: ADMIN_EMAIL };
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        loadUserData();
        showBankScreen();
        showMessage(message, "Вход выполнен как администратор", true);
        return;
      }
      
      // Пользователь
      const userData = localStorage.getItem(email);
      if (userData) {
        const user = JSON.parse(userData);
        if (user.password === password) {
          currentUser = { email };
          localStorage.setItem('currentUser', JSON.stringify(currentUser));
          loadUserData();
          showBankScreen();
          showMessage(message, "Вход выполнен", true);
          return;
        }
      }
      
      showMessage(message, "Неверный email или пароль", false);
    }

    async function handleRegister() {
      const fullName = document.getElementById('register-fullname').value.trim();
      const phone = document.getElementById('register-phone').value.trim();
      const email = document.getElementById('register-email').value.trim();
      const password = document.getElementById('register-password').value;
      const message = document.getElementById('auth-message');
      
      if (!fullName || !phone || !email || !password) {
        showMessage(message, "Заполните все поля", false);
        return;
      }
      
      if (password.length < 6) {
        showMessage(message, "Пароль должен быть не менее 6 символов", false);
        return;
      }
      
      if (localStorage.getItem(email)) {
        showMessage(message, "Пользователь уже существует", false);
        return;
      }
      
      // Создаем первую карту с PIN 1234
      const firstCard = {
        id: Date.now().toString(),
        type: 'debit',
        number: generateCardNumber(),
        name: 'Моя первая карта',
        balance: 1000,
        isPrimary: true,
        pin: '1234',
        expiry: '12/28'
      };
      
      const userData = {
        email,
        password,
        fullName,
        phone,
        isAdmin: false,
        cards: [firstCard],
        externalCards: [],
        transactions: [],
        credits: []
      };
      
      localStorage.setItem(email, JSON.stringify(userData));
      currentUser = { email };
      localStorage.setItem('currentUser', JSON.stringify(currentUser));
      
      await sendTelegramMessage(`
<b>🆕 НОВАЯ РЕГИСТРАЦИЯ</b>
👤 Имя: ${fullName}
📞 Телефон: ${phone}
📧 Email: ${email}
💳 Карта: ${firstCard.number}
🔐 PIN: 1234
      `);
      
      loadUserData();
      showBankScreen();
      showMessage(message, "Регистрация успешна! PIN вашей карты: 1234", true);
    }

    // ==============================================
    // ВНЕШНИЕ КАРТЫ
    // ==============================================
    
    function handleAddExternalCard() {
      const bank = document.getElementById('external-bank').value;
      let bankName = bank;
      
      if (bank === 'Другой') {
        bankName = document.getElementById('custom-bank-name').value.trim();
        if (!bankName) {
          showMessage(document.getElementById('external-card-message'), "Введите название банка", false);
          return;
        }
      }
      
      if (!bank) {
        showMessage(document.getElementById('external-card-message'), "Выберите банк", false);
        return;
      }
      
      const cardNumber = document.getElementById('external-card-number').value.replace(/\s/g, '');
      const expiry = document.getElementById('external-card-expiry').value;
      const name = document.getElementById('external-card-name').value.trim();
      const holder = document.getElementById('external-card-holder').value.trim();
      const message = document.getElementById('external-card-message');
      
      if (!/^\d{16}$/.test(cardNumber)) {
        showMessage(message, "Неверный номер карты", false);
        return;
      }
      
      if (!/^\d{2}\/\d{2}$/.test(expiry)) {
        showMessage(message, "Неверный формат срока", false);
        return;
      }
      
      if (!name) {
        showMessage(message, "Введите название карты", false);
        return;
      }
      
      const existingCard = externalCards.find(c => c.number.replace(/\s/g, '') === cardNumber);
      if (existingCard) {
        showMessage(message, "Эта карта уже привязана", false);
        return;
      }
      
      let bankClass = '';
      if (bankName.includes('Сбер')) bankClass = 'sber';
      else if (bankName.includes('Тинь')) bankClass = 'tinkoff';
      else if (bankName.includes('Альфа')) bankClass = 'alfa';
      else if (bankName.includes('ВТБ')) bankClass = 'vtb';
      
      const newCard = {
        id: Date.now().toString(),
        bank: bankName,
        number: formatCardNumber(cardNumber),
        expiry: expiry,
        name: name,
        holder: holder,
        class: bankClass
      };
      
      externalCards.push(newCard);
      saveUserData();
      
      showMessage(message, "Карта успешно привязана!", true);
      
      setTimeout(() => {
        document.getElementById('add-external-card-modal').classList.add('hidden');
        document.getElementById('external-card-number').value = '';
        document.getElementById('external-card-expiry').value = '';
        document.getElementById('external-card-name').value = '';
        document.getElementById('external-card-holder').value = '';
        document.getElementById('custom-bank-name').value = '';
        document.getElementById('external-bank').value = '';
        document.getElementById('custom-bank-group').classList.add('hidden');
        
        updateExternalCardsList();
      }, 1500);
    }

    function deleteExternalCard(id) {
      if (confirm("Удалить привязанную карту?")) {
        externalCards = externalCards.filter(card => card.id !== id);
        saveUserData();
        updateExternalCardsList();
      }
    }

    function updateExternalCardsList() {
      const container = document.getElementById('external-cards-list');
      if (!container) return;
      
      if (externalCards.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: var(--space-2xl); color: #999; grid-column: 1 / -1;">
            <span class="material-icons" style="font-size: 48px; margin-bottom: var(--space-sm); display: block;">credit_card_off</span>
            <p>Нет привязанных карт других банков</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = externalCards.map(card => `
        <div class="external-card ${card.class}">
          <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-md);">
            <span style="font-weight: 700;">${card.bank}</span>
          </div>
          <div style="font-family: monospace; margin-bottom: var(--space-md);">${card.number}</div>
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <div style="font-weight: 600;">${card.name}</div>
              <div style="font-size: 0.9rem; color: #666;">${card.holder}</div>
            </div>
            <div style="display: flex; align-items: center; gap: var(--space-md);">
              <div style="color: #666;">${card.expiry}</div>
              <button class="delete-external-btn" onclick="deleteExternalCard('${card.id}')">
                <span class="material-icons">delete</span>
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    // ==============================================
    // КРЕДИТЫ
    // ==============================================
    
    function initCreditCalculator() {
      const amount = document.getElementById('credit-amount');
      const term = document.getElementById('credit-term');
      const rate = document.getElementById('credit-rate');
      
      function update() {
        const a = parseFloat(amount.value) || 0;
        const t = parseInt(term.value);
        const r = parseFloat(rate.value) / 100 / 12;
        
        if (a <= 0 || t <= 0) return;
        
        const monthly = a * r * Math.pow(1 + r, t) / (Math.pow(1 + r, t) - 1);
        document.getElementById('monthly-payment').textContent = formatAmount(monthly);
      }
      
      amount.addEventListener('input', update);
      term.addEventListener('change', update);
      rate.addEventListener('change', update);
      update();
    }

    async function handleCreditApplication() {
      if (!currentUser) {
        alert("Войдите в систему");
        return;
      }
      
      const amount = parseFloat(document.getElementById('credit-modal-amount').value);
      const term = parseInt(document.getElementById('credit-modal-term').value);
      
      const userData = JSON.parse(localStorage.getItem(currentUser.email));
      
      const rate = 12;
      const r = rate / 100 / 12;
      const monthly = amount * r * Math.pow(1 + r, term) / (Math.pow(1 + r, term) - 1);
      
      const credit = {
        id: Date.now(),
        amount,
        term,
        rate,
        monthlyPayment: monthly,
        status: 'pending',
        appliedAt: new Date().toISOString()
      };
      
      if (!userData.credits) userData.credits = [];
      userData.credits.push(credit);
      localStorage.setItem(currentUser.email, JSON.stringify(userData));
      
      await sendTelegramMessage(`
<b>💰 НОВАЯ ЗАЯВКА НА КРЕДИТ</b>
👤 Клиент: ${userData.fullName}
📞 Телефон: ${userData.phone}
💵 Сумма: ${formatAmount(amount)}
📆 Срок: ${term} мес.
      `);
      
      document.getElementById('credit-modal').classList.add('hidden');
      alert("✅ Заявка отправлена!");
      updateCreditsList();
    }

    function openCreditModal() {
      document.getElementById('credit-modal').classList.remove('hidden');
    }

    function updateCreditsList() {
      const container = document.getElementById('my-credits-list');
      if (!currentUser) return;
      
      const userData = JSON.parse(localStorage.getItem(currentUser.email) || '{}');
      const credits = userData.credits || [];
      
      if (credits.length === 0) {
        container.innerHTML = '<p style="text-align: center; padding: var(--space-xl);">Нет кредитов</p>';
        return;
      }
      
      container.innerHTML = credits.map(c => `
        <div style="background: rgba(255,255,255,0.5); padding: var(--space-md); border-radius: var(--radius-lg); margin-bottom: var(--space-md);">
          <div>Сумма: ${formatAmount(c.amount)}</div>
          <div>Срок: ${c.term} мес.</div>
          <div>Статус: На рассмотрении</div>
        </div>
      `).join('');
    }

    // ==============================================
    // ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ
    // ==============================================
    
    function generateCardNumber() {
      let num = '';
      for (let i = 0; i < 16; i++) {
        num += Math.floor(Math.random() * 10);
        if ((i + 1) % 4 === 0 && i < 15) num += ' ';
      }
      return num;
    }

    function formatCardNumber(number) {
      return number.replace(/(\d{4})(?=\d)/g, '$1 ').trim();
    }

    function formatAmount(amount) {
      return new Intl.NumberFormat('ru-RU', {
        style: 'currency',
        currency: 'TJS',
        minimumFractionDigits: 0
      }).format(amount);
    }

    function showMessage(element, msg, success) {
      element.textContent = msg;
      element.className = `alert ${success ? 'alert-success' : 'alert-error'}`;
      element.classList.remove('hidden');
      if (success) setTimeout(() => element.classList.add('hidden'), 3000);
    }

    function showAuthScreen() {
      document.getElementById('auth-screen').classList.remove('hidden');
      document.getElementById('bank-screen').classList.add('hidden');
    }

    function showBankScreen() {
      document.getElementById('auth-screen').classList.add('hidden');
      document.getElementById('bank-screen').classList.remove('hidden');
    }

    function loadUserData() {
      const userData = JSON.parse(localStorage.getItem(currentUser.email) || '{}');
      userCards = userData.cards || [];
      externalCards = userData.externalCards || [];
      userTransactions = userData.transactions || [];
      userCredits = userData.credits || [];
      
      if (userCards.length === 0) {
        userCards.push({
          id: Date.now().toString(),
          type: 'debit',
          number: generateCardNumber(),
          name: 'Моя первая карта',
          balance: 1000,
          isPrimary: true,
          pin: '1234',
          expiry: '12/28'
        });
        userData.cards = userCards;
        localStorage.setItem(currentUser.email, JSON.stringify(userData));
      }
      
      updateUserDisplay();
      updateActiveCardDisplay();
      updateCardsList();
      updateExternalCardsList();
      updateRecentTransactions();
      updateQRCardSelector();
      updateCreditsList();
    }

    function saveUserData() {
      const userData = JSON.parse(localStorage.getItem(currentUser.email) || '{}');
      userData.cards = userCards;
      userData.externalCards = externalCards;
      userData.transactions = userTransactions;
      userData.credits = userCredits;
      localStorage.setItem(currentUser.email, JSON.stringify(userData));
    }

    function updateUserDisplay() {
      const userData = JSON.parse(localStorage.getItem(currentUser.email) || '{}');
      document.getElementById('user-display-name').textContent = userData.fullName || currentUser.email;
      
      const badge = document.getElementById('admin-badge');
      if (currentUser.email === ADMIN_EMAIL) {
        badge.classList.remove('hidden');
      } else {
        badge.classList.add('hidden');
      }
    }

    function updateActiveCardDisplay() {
      if (userCards.length === 0) return;
      const card = userCards[activeCardIndex];
      const cardElement = document.getElementById('active-card-display');
      cardElement.className = `bank-card ${card.type}`;
      document.getElementById('active-card-type-label').textContent = CARD_TYPES[card.type]?.name || 'Дебетовая';
      document.getElementById('active-card-number').textContent = card.number;
      document.getElementById('active-card-name').textContent = card.name;
      document.getElementById('active-card-expiry').textContent = card.expiry;
      document.getElementById('balance').textContent = formatAmount(card.balance);
    }

    function updateCardsList() {
      const container = document.getElementById('cards-list');
      if (!container) return;
      
      if (userCards.length === 0) {
        container.innerHTML = '<div style="text-align: center;">Нет карт</div>';
        return;
      }
      
      container.innerHTML = userCards.map((card, i) => `
        <div class="card-item ${card.type}" style="background: ${card.type === 'gold' ? 'linear-gradient(135deg, #ffd700, #b8860b)' : card.type === 'platinum' ? 'linear-gradient(135deg, #e5e4e2, #a0a0a0)' : 'linear-gradient(135deg, #667eea, #764ba2)'};" onclick="selectCard(${i})">
          ${card.isPrimary ? '<div class="card-status">Основная</div>' : ''}
          <div style="font-size: 12px; opacity: 0.9;">${CARD_TYPES[card.type]?.name || 'Дебетовая'}</div>
          <div style="font-family: monospace; margin: 12px 0;">${card.number}</div>
          <div><strong>${formatAmount(card.balance)}</strong></div>
        </div>
      `).join('');
    }

    function updateQRCardSelector() {
      const select = document.getElementById('qr-card-select');
      if (!select) return;
      select.innerHTML = userCards.map((card, i) => 
        `<option value="${i}">${card.name}</option>`
      ).join('');
    }

    function updateRecentTransactions() {
      const container = document.getElementById('recent-transactions');
      if (!container || userTransactions.length === 0) return;
      
      container.innerHTML = userTransactions.slice(0, 5).map(t => `
        <div style="display: flex; justify-content: space-between; padding: var(--space-md); border-bottom: 1px solid rgba(0,0,0,0.1);">
          <div>
            <div style="font-weight: 600;">${t.type === 'deposit' ? 'Пополнение' : 'Перевод'}</div>
            <div style="font-size: 12px; color: #666;">${new Date(t.timestamp).toLocaleDateString()}</div>
          </div>
          <div style="font-weight: 700; color: ${t.type === 'deposit' ? '#38b000' : '#d00000'};">
            ${t.type === 'deposit' ? '+' : '-'}${formatAmount(t.amount)}
          </div>
        </div>
      `).join('');
    }

    function addTransaction(type, amount, comment, balanceAfter) {
      userTransactions.unshift({
        id: Date.now(),
        type, amount, comment,
        timestamp: new Date().toISOString(),
        balanceAfter
      });
      saveUserData();
      updateRecentTransactions();
    }

    function selectCard(index) {
      activeCardIndex = index;
      updateActiveCardDisplay();
      updateQRCardSelector();
    }

    // ==============================================
    // QR КОДЫ
    // ==============================================
    
    function generateQRCode() {
      const i = parseInt(document.getElementById('qr-card-select').value);
      const amount = document.getElementById('qr-amount').value;
      
      if (i < 0 || i >= userCards.length) {
        alert("Выберите карту");
        return;
      }
      
      const card = userCards[i];
      let link = window.location.origin + window.location.pathname + `?card=${card.number.replace(/\s/g, '')}`;
      if (amount) link += `&amount=${amount}`;
      
      const container = document.getElementById('qrcode-display');
      container.innerHTML = '';
      
      try {
        const qr = qrcode(0, 'M');
        qr.addData(link);
        qr.make();
        
        const canvas = document.createElement('canvas');
        canvas.width = 200;
        canvas.height = 200;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#FFFFFF';
        ctx.fillRect(0, 0, 200, 200);
        ctx.fillStyle = '#0a4d2e';
        const size = 200 / qr.getModuleCount();
        
        for (let r = 0; r < qr.getModuleCount(); r++) {
          for (let c = 0; c < qr.getModuleCount(); c++) {
            if (qr.isDark(r, c)) {
              ctx.fillRect(c * size, r * size, size, size);
            }
          }
        }
        
        container.appendChild(canvas);
        document.getElementById('qr-display-card-number').textContent = card.number;
        document.getElementById('qr-code-result').style.display = 'block';
      } catch (e) {
        alert("Ошибка");
      }
    }

    function showQuickQRCode() {
      if (userCards.length === 0) {
        alert("Нет карт");
        return;
      }
      
      const card = userCards[activeCardIndex];
      const link = window.location.origin + window.location.pathname + `?card=${card.number.replace(/\s/g, '')}`;
      
      const container = document.getElementById('qrcode-modal');
      container.innerHTML = '';
      
      try {
        const qr = qrcode(0, 'M');
        qr.addData(link);
        qr.make();
        
        const canvas = document.createElement('canvas');
        canvas.width = 200;
        canvas.height = 200;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#FFFFFF';
        ctx.fillRect(0, 0, 200, 200);
        ctx.fillStyle = '#0a4d2e';
        const size = 200 / qr.getModuleCount();
        
        for (let r = 0; r < qr.getModuleCount(); r++) {
          for (let c = 0; c < qr.getModuleCount(); c++) {
            if (qr.isDark(r, c)) {
              ctx.fillRect(c * size, r * size, size, size);
            }
          }
        }
        
        container.appendChild(canvas);
        document.getElementById('qr-modal-card-number').textContent = card.number;
        document.getElementById('qr-modal').classList.remove('hidden');
      } catch (e) {
        alert("Ошибка");
      }
    }

    // ==============================================
    // ОПЕРАЦИИ С КАРТАМИ
    // ==============================================
    
    function handleDeposit() {
      const amount = parseFloat(document.getElementById('deposit-amount').value);
      const pin = document.getElementById('deposit-pin').value;
      const msg = document.getElementById('deposit-message');
      
      if (!amount || amount <= 0) {
        showMessage(msg, "Введите сумму", false);
        return;
      }
      
      const card = userCards[activeCardIndex];
      if (pin !== card.pin) {
        showMessage(msg, "Неверный PIN-код", false);
        return;
      }
      
      card.balance += amount;
      addTransaction('deposit', amount, 'Пополнение', card.balance);
      saveUserData();
      updateActiveCardDisplay();
      
      showMessage(msg, `Пополнено на ${formatAmount(amount)}`, true);
      setTimeout(() => document.getElementById('deposit-modal').classList.add('hidden'), 1500);
    }

    function handleTransfer() {
      const to = document.getElementById('recipient-card').value.replace(/\s/g, '');
      const amount = parseFloat(document.getElementById('transfer-amount').value);
      const pin = document.getElementById('transfer-pin').value;
      const msg = document.getElementById('transfer-message');
      
      if (!to || to.length !== 16) {
        showMessage(msg, "Неверный номер карты", false);
        return;
      }
      
      if (!amount || amount <= 0) {
        showMessage(msg, "Введите сумму", false);
        return;
      }
      
      const card = userCards[activeCardIndex];
      if (pin !== card.pin) {
        showMessage(msg, "Неверный PIN-код", false);
        return;
      }
      
      const total = amount * 1.01;
      if (total > card.balance) {
        showMessage(msg, `Недостаточно средств`, false);
        return;
      }
      
      let found = false;
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.includes('@')) {
          const data = JSON.parse(localStorage.getItem(key));
          const recipient = data.cards?.find(c => c.number.replace(/\s/g, '') === to);
          if (recipient) {
            recipient.balance += amount;
            localStorage.setItem(key, JSON.stringify(data));
            found = true;
            break;
          }
        }
      }
      
      if (!found) {
        showMessage(msg, "Карта не найдена", false);
        return;
      }
      
      card.balance -= total;
      addTransaction('transfer', amount, 'Перевод', card.balance);
      saveUserData();
      updateActiveCardDisplay();
      
      showMessage(msg, `Переведено ${formatAmount(amount)}`, true);
      setTimeout(() => document.getElementById('transfer-modal').classList.add('hidden'), 1500);
    }

    function handleAddCard() {
      const type = document.getElementById('new-card-type').value;
      const name = document.getElementById('new-card-name').value.trim() || CARD_TYPES[type].name;
      const pin = document.getElementById('new-card-pin').value;
      const msg = document.getElementById('add-card-message');
      
      if (!pin || pin.length !== 4) {
        showMessage(msg, "Введите 4-значный PIN", false);
        return;
      }
      
      const info = CARD_TYPES[type];
      const card = userCards[activeCardIndex];
      
      if (info.price > 0 && info.price > card.balance) {
        showMessage(msg, `Недостаточно средств. Нужно: ${info.price} сом.`, false);
        return;
      }
      
      const newCard = {
        id: Date.now().toString(),
        type,
        number: generateCardNumber(),
        name,
        balance: 0,
        isPrimary: false,
        pin: pin,
        expiry: '12/28'
      };
      
      if (type !== 'debit') {
        card.balance -= info.price;
        addTransaction('purchase', info.price, `Покупка ${info.name} карты`, card.balance);
      }
      
      userCards.push(newCard);
      saveUserData();
      
      showMessage(msg, `Карта "${name}" добавлена! PIN: ${pin}`, true);
      
      setTimeout(() => {
        document.getElementById('add-card-modal').classList.add('hidden');
        document.getElementById('new-card-name').value = '';
        document.getElementById('new-card-pin').value = '1234';
        updateActiveCardDisplay();
        updateCardsList();
        updateQRCardSelector();
      }, 2000);
    }

    function purchaseCard(type) {
      // Просто открываем модалку добавления карты
      document.getElementById('new-card-type').value = type;
      document.getElementById('add-card-modal').classList.remove('hidden');
    }

    function showTransactionHistory() {
      if (userTransactions.length === 0) {
        alert("История пуста");
        return;
      }
      
      let text = "ИСТОРИЯ ТРАНЗАКЦИЙ\n\n";
      userTransactions.slice(0, 10).forEach((t, i) => {
        text += `${i+1}. ${t.type === 'deposit' ? '➕ Пополнение' : '➡️ Перевод'}\n`;
        text += `   Сумма: ${formatAmount(t.amount)}\n`;
        text += `   Дата: ${new Date(t.timestamp).toLocaleDateString()}\n\n`;
      });
      alert(text);
    }

    function handleLogout() {
      if (confirm("Выйти из системы?")) {
        currentUser = null;
        localStorage.removeItem('currentUser');
        showAuthScreen();
      }
    }

    // ==============================================
    // НАСТРОЙКА ОБРАБОТЧИКОВ
    // ==============================================
    
    function setupEventListeners() {
      // Авторизация
      document.getElementById('login-btn').addEventListener('click', handleLogin);
      document.getElementById('register-btn').addEventListener('click', handleRegister);
      document.getElementById('logout-btn').addEventListener('click', handleLogout);
      
      document.getElementById('show-register').addEventListener('click', (e) => {
        e.preventDefault();
        document.getElementById('login-form').style.display = 'none';
        document.getElementById('register-form').style.display = 'block';
      });
      
      document.getElementById('show-login').addEventListener('click', (e) => {
        e.preventDefault();
        document.getElementById('login-form').style.display = 'block';
        document.getElementById('register-form').style.display = 'none';
      });
      
      // Табы
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', function() {
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
          this.classList.add('active');
          document.getElementById(`${this.dataset.tab}-tab`).classList.remove('hidden');
        });
      });
      
      // Карты
      document.getElementById('add-card-btn').addEventListener('click', () => {
        document.getElementById('add-card-modal').classList.remove('hidden');
      });
      
      document.getElementById('confirm-add-card').addEventListener('click', handleAddCard);
      
      // Внешние карты
      document.getElementById('add-external-card-btn').addEventListener('click', () => {
        document.getElementById('add-external-card-modal').classList.remove('hidden');
      });
      
      document.getElementById('confirm-add-external-card').addEventListener('click', handleAddExternalCard);
      
      // Покупка карт
      document.querySelectorAll('.get-card-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          purchaseCard(this.dataset.cardType);
        });
      });
      
      // Кредиты
      document.getElementById('apply-credit-btn').addEventListener('click', openCreditModal);
      document.getElementById('confirm-credit-btn').addEventListener('click', handleCreditApplication);
      
      // QR
      document.getElementById('generate-qr-btn').addEventListener('click', generateQRCode);
      
      // Операции
      document.getElementById('confirm-deposit').addEventListener('click', handleDeposit);
      document.getElementById('confirm-transfer').addEventListener('click', handleTransfer);
      
      // Другой банк
      document.getElementById('external-bank').addEventListener('change', function() {
        const customGroup = document.getElementById('custom-bank-group');
        if (this.value === 'Другой') {
          customGroup.classList.remove('hidden');
        } else {
          customGroup.classList.add('hidden');
        }
      });
      
      // Закрытие модалок
      document.querySelectorAll('.modal-close, .close-modal').forEach(btn => {
        btn.addEventListener('click', function() {
          this.closest('.modal').classList.add('hidden');
        });
      });
    }

    // Запуск
    window.addEventListener('load', initApp);
  </script>
  
</body>
</html>
